<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Home Dashboard</title>

<style>

body {
  margin:0;
  padding:28px;
  font-family:-apple-system,BlinkMacSystemFont,Arial,sans-serif;
  background:#0b0f14;
  color:#e6e9ef;
}

/* ---------- CLOCK ---------- */

.header {
  font-size:72px;
  font-weight:600;
  letter-spacing:2px;
  margin-bottom:28px;
}

/* ---------- GRID ---------- */

.grid {
  display:grid;
  grid-template-columns:2.4fr 1fr;
  gap:24px;
}

/* ---------- PANELS ---------- */

.panel {
  background:#141922;
  border-radius:22px;
  padding:22px;
  box-shadow:0 10px 30px rgba(0,0,0,.45);
}

.panel h2 {
  margin:0 0 16px 0;
  font-size:18px;
  font-weight:600;
  color:#8fa8ff;
  letter-spacing:.5px;
}

/* ---------- CALENDAR ---------- */

.dayBlock {
  margin-bottom:18px;
}

.dayTitle {
  font-size:17px;
  font-weight:600;
  color:#6f8cff;
  margin-bottom:6px;
}

.event {
  font-size:15px;
  margin-bottom:4px;
  display:flex;
  justify-content:space-between;
}

.time {
  color:#9aa6b5;
}

/* ---------- WEATHER ---------- */

.weatherTemp {
  font-size:54px;
  font-weight:600;
}

.weatherMeta {
  margin-top:8px;
  font-size:16px;
  color:#c3cad6;
}

/* ---------- TUB ---------- */

.tempBig {
  font-size:54px;
  font-weight:600;
}

.trend {
  font-size:20px;
  color:#9aa6b5;
  margin-left:8px;
}

.statRow {
  margin-top:10px;
  font-size:15px;
  color:#c3cad6;
  line-height:1.5;
}

.small {
  margin-top:10px;
  font-size:12px;
  color:#8b94a3;
}

/* ---------- STATUS DOT ---------- */

.dot {
  display:inline-block;
  width:10px;
  height:10px;
  border-radius:50%;
  margin-left:8px;
  background:#37d67a;
}

</style>
</head>

<body>

<div class="header" id="clock">--:--</div>

<div class="grid">

  <!-- CALENDAR -->
  <div class="panel">
    <h2>Next 5 Days</h2>
    <div id="calendar">Loading…</div>
  </div>

  <div>

    <!-- WEATHER -->
    <div class="panel">
      <h2>Today</h2>
      <div id="weather">Loading…</div>
    </div>

    <!-- HOT TUB -->
    <div class="panel" style="margin-top:24px;">
      <h2>Hot Tub</h2>
      <div id="tub">Loading…</div>
    </div>

  </div>

</div>

<script>

/* ---------- CLOCK ---------- */

function updateClock(){
  var now=new Date();
  document.getElementById("clock").innerHTML=
    now.toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"});
}
updateClock();
setInterval(updateClock,1000);


/* ---------- API ---------- */

var api =
"https://script.google.com/macros/s/AKfycbydfy3idgYUJXPNfHZ54LKWKkkljHYEr8ydMZKvaIrNANT_ccGfw_LgXVmSVckk4E-k6Q/exec";

fetch(api)
.then(r=>r.json())
.then(data=>{

  renderCalendar(data.events);
  renderTub(data);

});


/* ---------- CALENDAR (5-DAY FILTER) ---------- */

function renderCalendar(events){

  if(!events || events.length===0){
    calendar.innerHTML="No events";
    return;
  }

  var now=new Date();
  var end=new Date();
  end.setDate(now.getDate()+5);

  var grouped={};

  events.forEach(e=>{

    var d=new Date(e.start);

    if(d<now || d>end) return;

    var key=d.toDateString();

    if(!grouped[key]) grouped[key]=[];
    grouped[key].push(e);

  });

  var html="";

  Object.keys(grouped).forEach(day=>{

    html+="<div class='dayBlock'>";
    html+="<div class='dayTitle'>"+day+"</div>";

    grouped[day].forEach(e=>{

      var d=new Date(e.start);

      html+="<div class='event'>";
      html+="<span class='time'>"+
        d.toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"})+
        "</span>";
      html+="<span>"+e.title+"</span>";
      html+="</div>";

    });

    html+="</div>";

  });

  document.getElementById("calendar").innerHTML=html;

}


/* ---------- HOT TUB ---------- */

function fmt1(x){
  var n=Number(x);
  if(!isFinite(n)) return "-";
  return n.toFixed(1);
}

function trendSymbol(c,a){
  var d=c-a;
  if(Math.abs(d)<0.2) return "→";
  return d>0?"↑":"↓";
}

function renderTub(d){

  var html="";

  html+="<div class='tempBig'>";
  html+=fmt1(d.current)+"°";
  html+="<span class='trend'>"+
    trendSymbol(d.current,d.avg)+
  "</span>";
  html+="<span class='dot'></span>";
  html+="</div>";

  html+="<div class='statRow'>";
  html+="Min "+fmt1(d.min)+"°<br>";
  html+="Max "+fmt1(d.max)+"°<br>";
  html+="Avg "+fmt1(d.avg)+"°";
  html+="</div>";

  html+="<div class='small'>";
  html+="Updated "+
    new Date(d.as_of)
      .toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"});
  html+="</div>";

  tub.innerHTML=html;

}


/* ---------- WEATHER ---------- */

fetch(
"https://api.open-meteo.com/v1/forecast?latitude=43.945&longitude=-78.895&current_weather=true"
)
.then(r=>r.json())
.then(data=>{

  var w=data.current_weather;

  var html="";

  html+="<div class='weatherTemp'>"+w.temperature+"°C</div>";

  html+="<div class='weatherMeta'>";
  html+="Wind "+w.windspeed+" km/h<br>";
  html+="Dir "+w.winddirection+"°";
  html+="</div>";

  html+="<div class='small'>";
  html+="Updated "+
    new Date(w.time)
      .toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"});
  html+="</div>";

  weather.innerHTML=html;

});


/* ---------- AUTO REFRESH ---------- */

setInterval(()=>{
  location.reload();
},600000);

</script>

</body>
</html>
